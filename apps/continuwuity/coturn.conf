# Coturn Security-Hardened Configuration
# Enterprise-grade security settings for Matrix Conduit TURN server

# Authentication & Authorization
use-auth-secret
static-auth-secret=d5286002e9e14a2c56b4f7f4e0ba009c05274bbc973233bc4e6d7da25a01a9e7
realm=turn.asapllc.com
lt-cred-mech

# Network Listeners
listening-port=3478
tls-listening-port=5349
alt-listening-port=3479
alt-tls-listening-port=5350
listening-ip=0.0.0.0
external-ip=62.122.185.165

# Security: Block Private IP Ranges (RFC 1918)
denied-peer-ip=10.0.0.0-10.255.255.255
denied-peer-ip=172.16.0.0-172.31.255.255
denied-peer-ip=192.168.0.0-192.168.255.255

# Security: Block Localhost and Loopback
denied-peer-ip=127.0.0.0-127.255.255.255
denied-peer-ip=0.0.0.0-0.255.255.255

# Security: Block Multicast Ranges
denied-peer-ip=224.0.0.0-255.255.255.255

# Security: IPv6 Restrictions
denied-peer-ip=::1
denied-peer-ip=fc00::-fdff:ffff:ffff:ffff:ffff:ffff:ffff:ffff
denied-peer-ip=fe80::-febf:ffff:ffff:ffff:ffff:ffff:ffff:ffff

# Resource Limits & Rate Limiting
user-quota=5              # Max 5 concurrent sessions per user
total-quota=100           # Max 100 total concurrent sessions
max-bps=2000000          # 2 Mbps per connection
bps-capacity=50000000    # 50 Mbps total server capacity
max-allocate-timeout=14400  # 4 hours maximum session duration

# Security Features
no-tcp-relay
no-multicast-peers
no-loopback-peers
secure-stun
no-rfc5780

# Certificate Configuration (if using TLS)
# cert=/path/to/certificate.pem
# pkey=/path/to/private-key.pem
# dh-file=/path/to/dhparam.pem

# Database Configuration (optional - for persistent allocations)
# userdb=/var/lib/coturn/turndb
# lt-cred-mech

# Logging & Monitoring
log-file=stdout
verbose
log-binding
new-log-timestamp

# Performance Tuning
min-port=49152          # Start of UDP relay port range
max-port=65535          # End of UDP relay port range

# Additional Security Options
no-cli
no-stun-backward-compatibility
pidfile=/var/run/turnserver.pid

# Mobility Support (optional)
# mobility
# no-udp-relay

# Redis Integration (optional - for clustering)
# redis-userdb="host=redis-server dbname=0 password=turn connect_timeout=30"
# redis-statsdb="host=redis-server dbname=1 password=turn connect_timeout=30"

# Prometheus Metrics (optional)
# prometheus
# prometheus-port=9641

# Security Notes:
# 1. This configuration blocks all private IP ranges to prevent internal network access
# 2. Resource limits prevent DoS attacks through resource exhaustion
# 3. Verbose logging enables security monitoring and incident response
# 4. TLS encryption is available for secure TURN connections
# 5. Time-limited credentials reduce exposure from compromised credentials